{% extends "base.html" %}

{% block title %}View Items{% endblock %}

{% block content %}
<h1 class="mb-4">Inventory Items</h1>
<form method="GET" action="{{ url_for('view_items') }}" class="mb-4">
  <div class="input-group">
    <input type="text" class="form-control" placeholder="Search for items" name="search" value="{{ request.args.get('search', '') }}">
    <button class="btn btn-primary" type="submit">Search</button>
  </div>
</form>
<div class="d-flex justify-content-between" style="margin-bottom: 10px">
  <a href="{{ url_for('add_item') }}" class="btn btn-primary btn-sm" style="--bs-btn-bg: #ffffff; --bs-btn-color: #229ae0;">Add Item</a>
  <a href="{{ url_for('export_items') }}" class="btn btn-success btn-sm opacity-50" style="--bs-btn-bg: #ffffff; --bs-btn-color: #155724;">Export to CSV</a>
</div>
<table class="table table-striped table-bordered">
  <thead class="table-success">
    <tr>
      <th>
        <a href="{{ url_for('view_items', search=request.args.get('search', ''), sort_by='name', sort_order='asc' if sort_order == 'desc' or sort_by != 'name' else 'desc') }}">
          Name
          {% if sort_by == 'name' %}
            {% if sort_order == 'asc' %}
              ↑
            {% else %}
              ↓
            {% endif %}
          {% endif %}
        </a>
      </th>
      <th>
        <a href="{{ url_for('view_items', search=request.args.get('search', ''), sort_by='description', sort_order='asc' if sort_order == 'desc' or sort_by != 'description' else 'desc') }}">
          Description
          {% if sort_by == 'description' %}
            {% if sort_order == 'asc' %}
              ↑
            {% else %}
              ↓
            {% endif %}
          {% endif %}
        </a>
      </th>
      <th>
        <a href="{{ url_for('view_items', search=request.args.get('search', ''), sort_by='location', sort_order='asc' if sort_order == 'desc' or sort_by != 'location' else 'desc') }}">
          Location
          {% if sort_by == 'location' %}
            {% if sort_order == 'asc' %}
              ↑
            {% else %}
              ↓
            {% endif %}
          {% endif %}
        </a>
      </th>
      <th>
        <a href="{{ url_for('view_items', search=request.args.get('search', ''), sort_by='notes', sort_order='asc' if sort_order == 'desc' or sort_by != 'notes' else 'desc') }}">
          Notes
          {% if sort_by == 'notes' %}
            {% if sort_order == 'asc' %}
              ↑
            {% else %}
              ↓
            {% endif %}
          {% endif %}
        </a>
      </th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.name }}</td>
      <td>{{ item.description }}</td>
      <td>{{ item.location }}</td>
      <td>{{ item.notes }}</td>
      <td>
        <a href="{{ url_for('edit_item', item_id=item.id) }}" class="btn btn-outline-info btn-sm">Edit</a>
        <form method="POST" action="{{ url_for('delete_item', item_id=item.id) }}" style="display: inline;" onsubmit="return confirmDelete();"> <!-- onsubmit buttion added to trigger confirmDelete function-->
          <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Not ready to implement QR Code Scanner
<script>
  document.getElementById('scan-qr-btn').addEventListener('click', function() {
    document.getElementById('qr-reader').style.display = 'block';
    var html5QrcodeScanner = new Html5QrcodeScanner(
      "qr-reader", { fps: 10, qrbox: 250 });
    html5QrcodeScanner.render(onScanSuccess);
  });

  function onScanSuccess(decodedText, decodedResult) {
    console.log(`Code matched = ${decodedText}`, decodedResult);
    const [name, description] = decodedText.split(',');
    document.querySelector('[name="search"]').value = name;
    document.querySelector('form').submit();
    html5QrcodeScanner.clear();
    document.getElementById('qr-reader').style.display = 'none';
  }
</script>
-->
{% endblock %}
